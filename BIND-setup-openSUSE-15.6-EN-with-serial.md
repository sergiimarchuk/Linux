# BIND DNS Server and Client Setup (openSUSE Leap 15.6)

## üéØ Goal

Set up a local BIND DNS server for the domain **ps-state.org.local** in the `192.168.100.0/24` network, and ensure proper name resolution on all network clients.

---

## üß± 1. Install BIND

```bash
sudo zypper install bind bind-utils
```

---

## üîß 2. Configure BIND Service

```bash
sudo systemctl enable named
sudo systemctl start named
```

---

## üìÇ 3. Zone Configuration

File: `/etc/named.d/zone.conf`

```conf
zone "ps-state.org.local" IN {
    type master;
    file "/var/lib/named/master/ps-state.org.local.db";
    allow-update { none; };
};

zone "100.168.192.in-addr.arpa" IN {
    type master;
    file "/var/lib/named/master/100.168.192.in-addr.arpa.db";
    allow-update { none; };
};
```

Include the file in `/etc/named.conf`:

```conf
include "/etc/named.d/zone.conf";
```

---

## üìÑ 4. Forward Zone File: ps-state.org.local

Path: `/var/lib/named/master/ps-state.org.local.db`

```dns
$TTL 3600
@   IN  SOA mx.ps-state.org.local. root.ps-state.org.local. (
        2025100301 ; Serial
        10800      ; Refresh
        3600       ; Retry
        604800     ; Expire
        86400 )    ; Minimum TTL

@   IN  NS   mx.ps-state.org.local.
@   IN  A    192.168.100.205
@   IN  MX 10 mx.ps-state.org.local.

www IN  CNAME @
mx  IN  A    192.168.100.205
base-host-01 IN A 192.168.100.201
```

---

## üîÅ 5. Reverse Zone

Path: `/var/lib/named/master/100.168.192.in-addr.arpa.db`

```dns
$TTL 3600
@   IN  SOA mx.ps-state.org.local. root.ps-state.org.local. (
        2025100301 ; Serial
        10800
        3600
        604800
        86400 )

@   IN  NS   mx.ps-state.org.local.
205 IN  PTR  ps-state.org.local.
201 IN  PTR  base-host-01.ps-state.org.local.
```

---

## üîí 6. Zone File Permissions

```bash
sudo chown named:named /var/lib/named/master/*.db
sudo chmod 644 /var/lib/named/master/*.db
```

---

## ‚úÖ 7. Check Configuration

```bash
sudo named-checkconf
sudo named-checkzone ps-state.org.local /var/lib/named/master/ps-state.org.local.db
sudo named-checkzone 100.168.192.in-addr.arpa /var/lib/named/master/100.168.192.in-addr.arpa.db
```

---

## üîÑ 8. Reload Configuration

```bash
sudo rndc reload
```

---

## üß† 9. Configure Clients to Use Local BIND

‚ö†Ô∏è Do **not** edit `/etc/resolv.conf` manually ‚Äî it is auto-generated by `netconfig`.  

Edit `/etc/sysconfig/network/config`:

```bash
sudo vi /etc/sysconfig/network/config
```

Modify or add these lines:

```conf
NETCONFIG_DNS_STATIC_SERVERS="127.0.0.1 192.168.100.201"
NETCONFIG_DNS_STATIC_SEARCHLIST="ps-state.org.local"
```

- `127.0.0.1` ‚Üí local BIND server (if installed).  
- `192.168.100.201` ‚Üí your authoritative BIND server.  
- `ps-state.org.local` ‚Üí search domain for short hostname resolution.

Apply changes:

```bash
sudo netconfig update -f
```

Check `/etc/resolv.conf`:

```conf
search ps-state.org.local
nameserver 127.0.0.1
nameserver 192.168.100.201
```

---

### üîé 10. Test Resolution

```bash
ping base-host-01.ps-state.org.local
ping base-host-01
nslookup base-host-01.ps-state.org.local
dig @127.0.0.1 base-host-01.ps-state.org.local
dig -x 192.168.100.201
```

- Internal hosts should resolve via your BIND server.  
- External domains (like `yahoo.com`) resolve via recursion using root hints.

---

## üåê Notes on Root Servers

Your local BIND server can resolve external domains by querying root servers first. For example, `a.root-servers.net` and `b.root-servers.net` are root DNS servers responsible for the "." (root) zone. These root servers have information about top-level domains like `.com`, which in turn have authoritative information for `yahoo.com` or any other domain. When your server queries an external domain, it starts at the root, goes to the appropriate TLD server (e.g., `.com`), and then reaches the authoritative server for the requested domain.


file /etc/named.conf and this code 

zone "." in {
	type hint;
	file "root.hint";
};

is responsible to resolve external dns name the first step forward on root dns server as example these servers : 

`a.root-servers.net` and `b.root-servers.net`

and then go to .com dns server and then yahoo.com

---

## üìå Notes

- Always **increment the Serial number** when modifying zones to ensure changes propagate.  
- Use `rndc reload` to apply zone changes.  
- Verify BIND is listening on port 53:

```bash
sudo ss -tulpn | grep :53
```

- View logs:

```bash
sudo journalctl -u named -f
```

---

## üìù Example Serial Change

**Before (old zone):**

```dns
$TTL 3600
@   IN  SOA mx.ps-state.org.local. root.ps-state.org.local. (
        2025100301 10800 3600 604800 86400 )
@ IN NS mx.ps-state.org.local.
mx IN A 192.168.100.205
base-host-01 IN A 192.168.100.201
```

**After (added `base-host-02`):**

```dns
$TTL 3600
@   IN  SOA mx.ps-state.org.local. root.ps-state.org.local. (
        2025100302 10800 3600 604800 86400 )
@ IN NS mx.ps-state.org.local.
mx IN A 192.168.100.205
base-host-01 IN A 192.168.100.201
base-host-02 IN A 192.168.100.202
```

---

‚öôÔ∏è Diagnosis

## So, the issue is DNS resolution doesn‚Äôt work on seome hosts just very common issue especially erarlier,  but it does on your BIND server, only something local, see point 9 upper.

** That suggests one (or more) of these on bobby: **

```/etc/resolv.conf is missing or misconfigured ```

** It likely doesn‚Äôt point to your DNS server (base-host-01). **

- /etc/nsswitch.conf isn‚Äôt configured to use DNS

- It should have a line like:

``hosts: files dns``


- Firewall or network isolation between bobby and your DNS server.

- Less likely, since bobby and the DNS server are on the same subnet (192.168.100.x), and ping works fine. 

- Local caching resolver (systemd-resolved or dnsmasq) misconfiguration.

- Could cause it to ignore the correct nameserver.

---


**Key point:** Always increase the Serial number when you make any
change.\
Otherwise, BIND and clients may continue to use old cached data.

#
#
#

# DNS Records Reference (ps-state.org.local)

This table summarizes the main DNS record types used in the BIND configuration for `ps-state.org.local`, their purpose, practical reason, example, and the zone file where they are stored.

| Type | Description | Purpose / Practical Reason | Example | Zone File |
|------|------------|---------------------------|--------|-----------|
| **SOA** | Start of Authority, ‚Äúpassport‚Äù of the zone. | Allows secondary DNS servers to know where to get the current zone data and when to refresh cache. | `@ IN SOA mx.ps-state.org.local. root.ps-state.org.local. (2025100301 10800 3600 604800 86400)` | `/var/lib/named/master/ps-state.org.local.db` |
| **NS** | Name Server ‚Äî authoritative DNS server for the zone. | Lets any DNS query know which server holds authoritative information for this zone. | `@ IN NS mx.ps-state.org.local.` | `/var/lib/named/master/ps-state.org.local.db` |
| **A** | Maps a domain name to an IPv4 address. | Main way to find a server by name. | `base-host-01 IN A 192.168.100.201` | `/var/lib/named/master/ps-state.org.local.db` |
| **AAAA** | Maps a domain name to an IPv6 address. | Same as A, but for IPv6. | `host-ipv6 IN AAAA 2001:db8::1` | `/var/lib/named/master/ps-state.org.local.db` |
| **CNAME** | Canonical Name ‚Äî alias to another name. | Avoids duplicating IP addresses; allows multiple names pointing to the same host. | `www IN CNAME @` | `/var/lib/named/master/ps-state.org.local.db` |
| **MX** | Mail Exchange ‚Äî mail server for the domain. | Ensures email is delivered to the correct server for the domain. | `@ IN MX 10 mx.ps-state.org.local.` | `/var/lib/named/master/ps-state.org.local.db` |
| **PTR** | Pointer record (IP ‚Üí hostname), used in reverse zones. | Critical for email: checks IP ‚Üî hostname match. Without proper PTR, mail may be flagged as spam. Helps spam filters verify the server is legitimate. | `201 IN PTR base-host-01.ps-state.org.local.` | `/var/lib/named/master/100.168.192.in-addr.arpa.db` |
| **TXT** | Text record, often for SPF, DKIM, domain verification. | Verifies domain authenticity and mail settings, stores arbitrary metadata. | `@ IN TXT "v=spf1 mx -all"` | `/var/lib/named/master/ps-state.org.local.db` |
| **SRV** | Service record (e.g., LDAP, SIP). | Allows clients to automatically locate a service by priority and port. | `_ldap._tcp IN SRV 0 5 389 ldap.ps-state.org.local.` | `/var/lib/named/master/ps-state.org.local.db` |



